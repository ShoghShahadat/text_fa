// این فایل، قلب تپنده و مغز متفکر پکیج TextFa است.
// تمام منطق هوشمند برای تشخیص جهت متن در اینجا پیاده‌سازی می‌شود.
// خلق شده تحت فرماندهی و دیدگاه خلاقانه شما.

import 'package:flutter/widgets.dart';

/// یک کلاس ابزاری که منطق اصلی تشخیص جهت متن را در خود جای داده است.
/// این کار باعث می‌شود کد تمیزتر و قابل مدیریت‌تر باشد.
class TextFaLogic {
  /// تابع اصلی و استاتیک که یک رشته ورودی می‌گیرد و جهت غالب آن را برمی‌گرداند.
  ///
  /// [text]: متنی که باید جهت آن تشخیص داده شود.
  ///
  /// خروجی این تابع یکی از مقادیر `TextDirection.rtl` یا `TextDirection.ltr` خواهد بود.
  static TextDirection getDominantDirection(String text) {
    // اگر متن ورودی خالی یا null باشد، جهت پیش‌فرض چپ‌چین در نظر گرفته می‌شود.
    if (text.isEmpty) {
      return TextDirection.ltr;
    }

    // شمارنده‌ها برای کاراکترهای راست‌چین (فارسی/عربی) و چپ‌چین (لاتین).
    int rtlCharCount = 0;
    int ltrCharCount = 0;

    // پیمایش کاراکتر به کاراکتر در رشته ورودی.
    // استفاده از `runes` این اطمینان را می‌دهد که با کاراکترهای چند بایتی (مثل ایموجی‌ها) به درستی کار می‌کنیم.
    for (var rune in text.runes) {
      final charCode = rune;

      // بررسی اینکه آیا کد کاراکتر در محدوده حروف فارسی و عربی قرار دارد یا خیر.
      // محدوده \u0600 تا \u06FF شامل اکثر حروف رایج فارسی و عربی است.
      if (charCode >= 0x0600 && charCode <= 0x06FF) {
        rtlCharCount++;
      }
      // بررسی اینکه آیا کد کاراکتر در محدوده حروف بزرگ و کوچک لاتین قرار دارد یا خیر.
      // محدوده A-Z: \u0041 تا \u005A
      // محدوده a-z: \u0061 تا \u007A
      else if ((charCode >= 0x0041 && charCode <= 0x005A) ||
          (charCode >= 0x0061 && charCode <= 0x007A)) {
        ltrCharCount++;
      }
      // کاراکترهای دیگر (مانند اعداد، علائم نگارشی، فاصله‌ها و ایموجی‌ها)
      // در این منطق اولیه نادیده گرفته می‌شوند تا تأثیری بر تشخیص زبان غالب نگذارند.
    }

    // قانون غلبه که توسط شما وضع گردید:
    // اگر تعداد کاراکترهای فارسی بیشتر باشد، جهت متن راست‌چین خواهد بود.
    // در غیر این صورت (اگر تعداد مساوی یا کمتر باشد)، جهت متن چپ‌چین خواهد بود.
    // این باعث می‌شود متنی مثل "فلاتر version 3.0" به درستی راست‌چین نمایش داده شود.
    if (rtlCharCount > ltrCharCount) {
      return TextDirection.rtl;
    } else {
      return TextDirection.ltr;
    }
  }
}
